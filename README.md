# IntoTheCom CRM Calendar System

## üìã Descripci√≥n del Proyecto

Sistema CRM integral para **IntoTheCom**, agencia de marketing digital, con sincronizaci√≥n avanzada de Google Calendar. Desarrollado para optimizar la gesti√≥n de reuniones, contactos y sincronizaci√≥n autom√°tica de eventos.

## üèóÔ∏è Arquitectura del Sistema

### **Stack Tecnol√≥gico**
- **Backend**: Node.js + Express.js
- **Base de Datos**: PostgreSQL
- **Autenticaci√≥n**: Google OAuth2
- **API Externa**: Google Calendar API v3
- **Frontend**: HTML5 + CSS3 + JavaScript Vanilla
- **Deployment**: Railway Cloud Platform
- **Control de Versiones**: Git + GitHub

### **Arquitectura de Archivos**
```
CRM Intothecom/
‚îú‚îÄ‚îÄ server.js              # Aplicaci√≥n principal (Backend + Frontend)
‚îú‚îÄ‚îÄ package.json           # Dependencias del proyecto
‚îú‚îÄ‚îÄ .env                   # Variables de entorno (no incluido en repo)
‚îú‚îÄ‚îÄ README.md              # Esta documentaci√≥n
‚îú‚îÄ‚îÄ public/                # Recursos est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ Blanco sin fondo 72ppi.png    # Logo blanco para sidebar
‚îÇ   ‚îî‚îÄ‚îÄ negro sin fondo 72ppi.png     # Logo negro alternativo
‚îî‚îÄ‚îÄ .gitignore             # Archivos excluidos del repositorio
```

## üöÄ Funcionalidades Implementadas

### **1. Sistema de Autenticaci√≥n Google**
- **OAuth2 Flow completo** con Google Calendar
- **Estado persistente** de autenticaci√≥n
- **Manejo autom√°tico de tokens** y renovaci√≥n
- **Desconexi√≥n segura** y limpieza de credenciales

### **2. Calendario Avanzado**
#### **Vistas M√∫ltiples**
- **Vista D√≠a**: Eventos del d√≠a seleccionado con detalles completos
- **Vista Semana**: Grid semanal con slots de tiempo optimizados
- **Vista Mes**: Calendario mensual con d√≠as clicables

#### **Navegaci√≥n Inteligente**
- **Flechas de navegaci√≥n** (anterior/siguiente) por fecha
- **Bot√≥n "Hoy"** que cambia autom√°ticamente a vista d√≠a actual
- **D√≠as clicables** en vista mensual para cambio directo a vista d√≠a
- **T√≠tulos din√°micos** que muestran fecha/semana/mes actual

#### **Gesti√≥n de Eventos**
- **Sincronizaci√≥n en tiempo real** con Google Calendar
- **Cache inteligente** (1 minuto) para optimizaci√≥n de performance
- **Auto-sync cada 2 minutos** para actualizaciones autom√°ticas
- **Filtrado preciso** de eventos por fecha sin desfase de timezone
- **Enlaces directos** a reuniones de Google Meet

### **3. Gesti√≥n de Contactos Inteligente**
- **Extracci√≥n autom√°tica** de contactos de eventos
- **Sistema de etiquetas** con sincronizaci√≥n autom√°tica
- **Filtrado avanzado** por etiquetas, nombre y email
- **Ordenamiento m√∫ltiple** (recientes, nombre, reuniones)
- **Vista detallada** clickeable con informaci√≥n editable
- **Tracking de reuniones** por contacto con historial
- **Contador de reuniones** por contacto
- **Carga autom√°tica** al cambiar a pesta√±a contactos
- **API REST** para consultas y actualizaciones

### **4. Sistema de Sincronizaci√≥n**
- **Sync manual** on-demand
- **Sync autom√°tico** en background
- **Detecci√≥n de cambios** para evitar updates innecesarios
- **Manejo de errores** robusto con logging detallado

## üîß Configuraci√≥n del Entorno

### **Variables de Entorno Requeridas**
```env
DATABASE_URL=postgresql://usuario:password@host:puerto/database
GOOGLE_CLIENT_ID=tu_google_client_id
GOOGLE_CLIENT_SECRET=tu_google_client_secret
GOOGLE_REDIRECT_URI=https://tu-dominio.com/api/auth/google/callback
NODE_ENV=production
PORT=8080
```

### **Dependencias NPM**
```json
{
  "express": "^4.18.2",
  "cors": "^2.8.5", 
  "pg": "^8.11.3",
  "googleapis": "^126.0.1",
  "dotenv": "^16.3.1"
}
```

## üóÑÔ∏è Esquema de Base de Datos

### **Tabla: contacts**
```sql
CREATE TABLE contacts (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(255),
  first_seen DATE NOT NULL,
  last_seen DATE NOT NULL,
  meeting_count INTEGER DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### **Tabla: events**
```sql
CREATE TABLE events (
  id SERIAL PRIMARY KEY,
  google_event_id VARCHAR(255) UNIQUE NOT NULL,
  summary TEXT,
  start_time TIMESTAMP,
  end_time TIMESTAMP,
  attendees_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## üé® Dise√±o Premium y UX

### **Branding IntoTheCom Extraordinario**
- **Color Principal**: `#FF6B00` (Naranja corporativo)
- **Gradientes Avanzados**: `linear-gradient(135deg, #FF6B00 0%, #FF8533 100%)`
- **Glassmorphism**: Efectos de vidrio transl√∫cido con `backdrop-filter: blur(20px)`
- **Tipograf√≠a**: Fuente Inter para modernidad y legibilidad
- **Efectos de Profundidad**: Sombras multicapa y efectos 3D

### **Sidebar Extraordinaria**
- **Gradiente Oscuro**: `linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%)`
- **Efectos de Hover**: Transformaciones con `translateX(4px)`
- **Barras Laterales Animadas**: Efectos de profundidad con gradientes
- **Transiciones Suaves**: `cubic-bezier(0.4, 0, 0.2, 1)` para fluidez
- **Iconos Minimalistas**: Sin emojis, solo formas geom√©tricas profesionales

### **Componentes Premium**
- **Botones con Brillo**: Efectos de luz deslizante al hover
- **Modales con Glassmorphism**: Bordes redondeados y efectos de cristal
- **Formularios Interactivos**: Focus states con glow effects naranja
- **Cards con Profundidad**: Elevaci√≥n en hover con sombras din√°micas
- **Filtros Avanzados**: Glassmorphism con efectos de profundidad
- **Badges de Etiquetas**: Gradientes y sombras profesionales

### **Efectos Visuales Avanzados**
- **Microinteracciones**: Hover effects con `translateY(-2px)`
- **Animaciones de Entrada**: `slideIn` y `fadeIn` para modales
- **Efectos de Cristal**: M√∫ltiples capas de transparencia
- **Sombras Din√°micas**: Cambios de elevaci√≥n seg√∫n interacci√≥n
- **Variables CSS**: Sistema de colores y efectos consistente

### **Responsive Design**
- **Mobile First**: Adaptaci√≥n autom√°tica a dispositivos m√≥viles
- **Sidebar Responsive**: Colapsa elegantemente en pantallas peque√±as
- **Grid Flexible**: Calendario adaptativo con efectos preservados
- **Touch Friendly**: Elementos optimizados para dispositivos t√°ctiles

## üì° API Endpoints

### **Autenticaci√≥n**
- `GET /api/auth/google` - Iniciar flujo OAuth2
- `GET /api/auth/google/callback` - Callback de autenticaci√≥n
- `POST /api/auth/disconnect` - Desconectar cuenta Google

### **Calendario**
- `GET /api/calendar/events?view={day|week|month}&date=YYYY-MM-DD` - Obtener eventos
- `GET /api/calendar/sync` - Sincronizaci√≥n manual

### **Contactos**
- `GET /api/contacts` - Listar todos los contactos
- `GET /api/contacts/new?days=N` - Contactos de √∫ltimos N d√≠as
- `POST /api/sync` - Sincronizar contactos desde eventos

### **Sistema**
- `GET /health` - Health check del servidor

## üîç Funcionalidades T√©cnicas Avanzadas

### **Manejo de Timezone**
```javascript
// Funci√≥n helper para evitar desfase de fechas
function getLocalDateString(date) {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return year + '-' + month + '-' + day;
}
```

### **Cache Management**
- **Duraci√≥n**: 1 minuto para eventos de calendario
- **Invalidaci√≥n**: Autom√°tica al cambiar fechas o vistas
- **Optimizaci√≥n**: Reduce llamadas API y mejora performance

### **Error Handling**
- **Manejo robusto** de errores de API de Google
- **Fallbacks autom√°ticos** para reconexi√≥n
- **Logging detallado** para debugging
- **Mensajes user-friendly** en espa√±ol

## üöÄ Deployment en Railway

### **Configuraci√≥n**
1. **Conectar repositorio** GitHub a Railway
2. **Configurar variables** de entorno en Railway dashboard
3. **Deploy autom√°tico** desde branch main
4. **Database PostgreSQL** managed by Railway

### **URL de Producci√≥n**
```
https://crm-intothecom-production.up.railway.app/
```

## üõ†Ô∏è Comandos de Desarrollo

### **Instalaci√≥n**
```bash
npm install
```

### **Desarrollo Local**
```bash
npm start
# Servidor disponible en http://localhost:8080
```

### **Testing de API**
```bash
# Health check
curl https://tu-dominio.com/health

# Obtener contactos
curl https://tu-dominio.com/api/contacts
```

## üìä Logging y Debugging

### **Logs Implementados**
- **Navegaci√≥n de fechas**: Track de cambios de vista y fecha
- **Filtrado de eventos**: Debug de selecci√≥n de eventos por fecha
- **Sincronizaci√≥n**: Estado de sync con Google Calendar
- **Autenticaci√≥n**: Estado de tokens y conexiones
- **Base de datos**: Operaciones CRUD con timestamps

### **Debug en Consola**
```javascript
// Ejemplos de logs disponibles
console.log('Navigation - Previous date:', prevDate, 'New date:', currentDate);
console.log('Day view filtering:', { selectedDate, totalEvents, eventsData });
console.log('Selected day from month view:', { dateString, selectedDate, view });
```

## üîÑ Historial de Versiones

### **v2.0 - Redise√±o Premium con Glassmorphism (Diciembre 2024)**
- üé® **Transformaci√≥n visual completa** con efectos de glassmorphism
- ‚ú® **Sidebar extraordinaria** con gradientes oscuros y efectos de profundidad
- üéØ **Sistema de contactos inteligente** con filtrado avanzado por etiquetas
- üîÑ **Sincronizaci√≥n autom√°tica** de etiquetas evento-contacto
- üíé **Modales premium** con animaciones suaves y efectos de cristal
- üöÄ **Botones con efectos de brillo** y microinteracciones
- üì± **Carga autom√°tica** de contactos al cambiar pesta√±as
- üé™ **Efectos de hover** con transformaciones 3D
- üåü **Branding consistente** en toda la plataforma
- üîß **Correcciones cr√≠ticas** de funcionalidad post-redesign

### **v1.0 - Versi√≥n Estable Inicial**
- ‚úÖ Sistema completo de autenticaci√≥n Google
- ‚úÖ Calendario multi-vista funcional
- ‚úÖ Navegaci√≥n avanzada con bot√≥n "Hoy"
- ‚úÖ D√≠as clicables en vista mensual
- ‚úÖ Sincronizaci√≥n autom√°tica de eventos
- ‚úÖ Gesti√≥n completa de contactos
- ‚úÖ Fix cr√≠tico de timezone en selecci√≥n de fechas
- ‚úÖ UI/UX optimizada con branding IntoTheCom
- ‚úÖ Deploy estable en Railway

## üîÆ Roadmap Futuro

### **Mejoras Planificadas**
- [ ] **Notificaciones Push** para pr√≥ximas reuniones
- [ ] **Filtros avanzados** por tipo de evento o contacto
- [ ] **Dashboard analytics** con m√©tricas de reuniones
- [ ] **Integraci√≥n CRM** con leads y oportunidades
- [ ] **Exportaci√≥n de datos** a CSV/Excel
- [ ] **API REST completa** para integraciones externas
- [ ] **Multi-usuario** con roles y permisos
- [ ] **Webhooks** para eventos de Google Calendar

## üë®‚Äçüíª Informaci√≥n de Desarrollo

### **Desarrollado por**: Claude Code AI Assistant
### **Cliente**: IntoTheCom - Agencia de Marketing Digital
### **Per√≠odo**: 2025
### **Tecnolog√≠as**: Node.js, PostgreSQL, Google Calendar API
### **Deployment**: Railway Cloud Platform

## üìû Soporte T√©cnico

Para issues o mejoras, crear ticket en el repositorio GitHub:
```
https://github.com/imc400/crm-intothecom/issues
```

## üîê Consideraciones de Seguridad

- **OAuth2** implementado seg√∫n mejores pr√°cticas
- **Variables de entorno** para datos sensibles
- **HTTPS** obligatorio en producci√≥n
- **Validaci√≥n** de inputs en todas las APIs
- **Rate limiting** impl√≠cito v√≠a Google API quotas

---

## ü§ñ Contexto de Desarrollo para IA

### **Informaci√≥n para Continuaci√≥n de Desarrollo**

**Esta secci√≥n contiene contexto espec√≠fico para asistentes de IA que contin√∫en el desarrollo del proyecto.**

#### **Problemas Cr√≠ticos Resueltos**

1. **Errores JavaScript Cr√≠ticos (Resueltos)**
   - **Error**: `Uncaught SyntaxError: Unexpected string` en onclick handlers
   - **Causa**: Caracteres especiales sin escapar en strings JavaScript
   - **Soluci√≥n**: Implementaci√≥n de funci√≥n `safeOnclick()` para escape autom√°tico
   - **Ubicaci√≥n**: `server.js:head section` - funci√≥n helper para escape de caracteres

2. **Funci√≥n No Definida (Resuelto)**
   - **Error**: `authenticateGoogle is not defined`
   - **Causa**: Funci√≥n definida despu√©s de su uso en onclick handlers
   - **Soluci√≥n**: Creaci√≥n de `window.startGoogleAuth` en head section
   - **Ubicaci√≥n**: `server.js:head section` - funci√≥n de autenticaci√≥n global

3. **Contactos con Etiquetas No Sincronizados (Resuelto)**
   - **Problema**: Contactos con etiquetas en eventos no aparec√≠an en pesta√±a contactos
   - **Causa**: Falta de sincronizaci√≥n entre tablas events y contacts
   - **Soluci√≥n**: Endpoint `/api/sync-attendee-tags` para sincronizaci√≥n autom√°tica
   - **Ubicaci√≥n**: `server.js:1847-1892` - sincronizaci√≥n de etiquetas

4. **Funcionalidad Rota Post-Redise√±o (Resuelto)**
   - **Problema**: Scroll y clicks no funcionaban despu√©s del redise√±o glassmorphism
   - **Causa**: CSS `overflow: hidden` y z-index mal configurados
   - **Soluci√≥n**: `overflow-y: auto` y `pointer-events: none` en pseudo-elementos
   - **Ubicaci√≥n**: `server.js:CSS section` - ajustes de z-index y overflow

#### **Arquitectura del C√≥digo**

**Archivo Principal**: `server.js` (Aplicaci√≥n monol√≠tica)
- **L√≠neas 1-200**: Configuraci√≥n de servidor, database, y autenticaci√≥n
- **L√≠neas 200-500**: Endpoints de API REST
- **L√≠neas 500-1000**: L√≥gica de sincronizaci√≥n y contactos
- **L√≠neas 1000-1500**: HTML templates y estructura
- **L√≠neas 1500-2000**: CSS con efectos glassmorphism
- **L√≠neas 2000-2500**: JavaScript frontend y funcionalidad

#### **Funciones Cr√≠ticas a Preservar**

1. **Autenticaci√≥n Google** (`server.js:head section`)
   ```javascript
   window.startGoogleAuth = function() {
     fetch('/api/auth/google')
       .then(response => response.json())
       .then(result => {
         if (result.success && result.authUrl) {
           window.open(result.authUrl, '_blank');
         }
       });
   };
   ```

2. **Sincronizaci√≥n de Etiquetas** (`server.js:1847-1892`)
   ```javascript
   app.post('/api/sync-attendee-tags', async (req, res) => {
     // Sincroniza etiquetas entre eventos y contactos
     // CR√çTICO: No modificar sin entender el flujo completo
   });
   ```

3. **Funci√≥n Helper SafeOnclick** (`server.js:head section`)
   ```javascript
   function safeOnclick(str) {
     return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
   }
   ```

#### **Efectos CSS Glassmorphism**

**Variables CSS Cr√≠ticas**:
```css
:root {
  --primary-orange: #FF6B00;
  --glass-bg: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-blur: blur(20px);
}
```

**Efectos de Profundidad**:
- **Sidebar**: `background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%)`
- **Glassmorphism**: `backdrop-filter: blur(20px)` + `border-radius: 16px`
- **Hover Effects**: `transform: translateY(-2px)` con `box-shadow` din√°mico

#### **Base de Datos - Esquema Cr√≠tico**

**Tabla Contacts** (Con todas las migraciones aplicadas):
```sql
CREATE TABLE contacts (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(255),
  first_seen DATE NOT NULL,
  last_seen DATE NOT NULL,
  meeting_count INTEGER DEFAULT 1,
  tags TEXT[] DEFAULT '{}',          -- A√±adido en migraci√≥n
  notes TEXT,                        -- A√±adido en migraci√≥n
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### **Flujo de Autenticaci√≥n Google**

1. **Inicio**: `window.startGoogleAuth()` llamado desde bot√≥n
2. **Redirect**: `/api/auth/google` genera URL de OAuth2
3. **Callback**: `/api/auth/google/callback` procesa respuesta
4. **PostMessage**: `window.postMessage` notifica √©xito a ventana principal
5. **Reload**: Frontend recarga eventos autom√°ticamente

#### **Patrones de C√≥digo Importantes**

1. **Escape de Caracteres**: Siempre usar `safeOnclick()` para onclick handlers
2. **Gesti√≥n de Estado**: Cache de eventos con TTL de 1 minuto
3. **Error Handling**: Try-catch en todas las funciones async
4. **Logging**: Console.log detallado para debugging
5. **Responsive**: Mobile-first con efectos preservados

#### **Comandos de Mantenimiento**

```bash
# Verificar estado de la aplicaci√≥n
curl https://crm-intothecom-production.up.railway.app/health

# Revisar logs en Railway
railway logs

# Backup de base de datos
railway run pg_dump $DATABASE_URL > backup.sql
```

#### **Warnings Cr√≠ticos para Desarrolladores**

‚ö†Ô∏è **NUNCA** modificar el orden de las funciones JavaScript sin verificar dependencias
‚ö†Ô∏è **NUNCA** cambiar z-index sin considerar el efecto en glassmorphism
‚ö†Ô∏è **NUNCA** modificar `/api/sync-attendee-tags` sin entender el flujo completo
‚ö†Ô∏è **SIEMPRE** usar `safeOnclick()` para nuevos onclick handlers
‚ö†Ô∏è **SIEMPRE** probar scroll y clicks despu√©s de cambios CSS

#### **Pr√≥ximos Pasos Sugeridos**

1. **Separar c√≥digo**: Dividir server.js en m√≥dulos (backend/frontend)
2. **Testing**: Implementar tests unitarios para funciones cr√≠ticas
3. **Performance**: Optimizar cache de eventos y contactos
4. **Monitoring**: Implementar logging estructurado
5. **Security**: Audit de seguridad en autenticaci√≥n OAuth2

#### **Contacto de Referencia**

- **Cliente**: IntoTheCom (Agencia de Marketing Digital)
- **Requerimientos**: Plataforma "extraordinaria" con efecto "WOW"
- **Prioridad**: Funcionalidad > Est√©tica (pero ambas cr√≠ticas)
- **Filosof√≠a**: "Necesito que act√∫es como un pro del desarrollo web... no soluciones parches"

---

**üéØ Proyecto completado exitosamente con todas las funcionalidades requeridas para un CRM profesional de agencia de marketing digital.**